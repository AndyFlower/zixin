<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cul.culsite.dao.expand.MMemberLevelDTOExpandMapper">
	<resultMap id="UserBenefitsResultMap" type="com.cul.culsite.model.UserBenefitsBean">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<result column="ML_LEVEL" property="level" jdbcType="VARCHAR" />
		<result column="ML_ID" property="mlId" jdbcType="VARCHAR" />
		<result column="ML_LEVEL_DESCRIPTION" property="levelDescription"
			jdbcType="VARCHAR" />
		<result column="ML_LIMIT_POINT_MAX" property="limitPointMax"
			jdbcType="DECIMAL" />
		<result column="ML_LIMIT_POINT_MIN" property="limitPointMin"
			jdbcType="DECIMAL" />
		<!-- 积分 -->
		<result column="Mbpr_Type" property="type" jdbcType="VARCHAR" />
		<result column="Mbpr_Description" property="description"
			jdbcType="VARCHAR" />
		<result column="Mbpr_Rule_Code" property="ruleCode" jdbcType="VARCHAR" />
		<result column="Mbpr_Is_Fixed" property="isFixed" jdbcType="VARCHAR" />
		<result column="Mbpr_Rate" property="rate" jdbcType="VARCHAR" />
		<result column="Mbpr_Cofficient" property="cofficient"
			jdbcType="VARCHAR" />
		<result column="Mbpr_Points" property="points" jdbcType="VARCHAR" />
		<result column="Mbpr_Min_Amount" property="minAmount" jdbcType="DECIMAL" />
		<result column="Mbpr_Max_Amount" property="maxAmount" jdbcType="DECIMAL" />
		<result column="Mbpr_Menchant_No" property="menchantNo"
			jdbcType="VARCHAR" />
		<result column="Mbpr_Area_Id" property="areaId" jdbcType="VARCHAR" />
		<result column="Mbpr_Product_Id" property="productId" jdbcType="VARCHAR" />
		<result column="Mbpr_Product_Category" property="productCategory"
			jdbcType="VARCHAR" />
		<result column="Mbpr_Points_Start_Date" property="pointsStartDate"
			jdbcType="VARCHAR" />
		<result column="Mbpr_Points_End_Date" property="pointsEndDate"
			jdbcType="VARCHAR" />
		<result column="Mbpr_Direction" property="direction" jdbcType="VARCHAR" />
		<result column="Mbpr_Status" property="status" jdbcType="VARCHAR" />
		<!-- 卷 -->
		<result column="MBDR_TYPE" property="type" jdbcType="VARCHAR" />
		<result column="MBDR_DESCRIPTION" property="description"
			jdbcType="VARCHAR" />
		<result column="MBDR_PROMOTION_TYPE" property="promotionType"
			jdbcType="VARCHAR" />
		<result column="MBDR_STATUS" property="status" jdbcType="VARCHAR" />
		<result column="MBDR_RULE_CODE" property="ruleCode" jdbcType="VARCHAR" />
		<result column="MBDR_IS_FIXED" property="isFixed" jdbcType="VARCHAR" />
		<result column="MBDR_COFFICIENT" property="cofficient"
			jdbcType="VARCHAR" />
		<result column="MBDR_AMOUNT" property="amount" jdbcType="DECIMAL" />
		<result column="MBDR_MIN_AMOUNT" property="minAmount" jdbcType="DECIMAL" />
		<result column="MBDR_MAX_AMOUNT" property="maxAmount" jdbcType="DECIMAL" />
		<result column="MBDR_MENCHANT_NO" property="menchantNo"
			jdbcType="VARCHAR" />
		<result column="MBDR_PRODUCT_ID" property="productId" jdbcType="VARCHAR" />
		<result column="MBDR_DISCOUNT_PRODUCT_ID" property="discountProductId"
			jdbcType="VARCHAR" />
		<result column="MBDR_START_DATE" property="startDate" jdbcType="VARCHAR" />
		<result column="MBDR_END_DATE" property="endDate" jdbcType="VARCHAR" />
		<!-- 主键编号 -->
		<result column="mbp_mbp_id" property="mbpId" jdbcType="VARCHAR" />
		<result column="mbp_mbr_id" property="mbrId" jdbcType="VARCHAR" />
	</resultMap>
	<!-- BenefitsPoints 权益包可以用 -->
	<select id="queryBenefitsPointsAndLevelbyIssuerIdAndcustSeq"
		resultMap="UserBenefitsResultMap" parameterType="java.util.Map">
		select a1.ml_level_description,
		a1.ML_LEVEL,
		a1.ML_ID,
		a1.Ml_Limit_Point_Max,
		a1.ml_limit_point_min,
		c.Mbpr_Type,
		c.Mbpr_Description,
		c.Mbpr_Rule_Code,
		c.Mbpr_Is_Fixed,
		c.Mbpr_Rate,
		c.Mbpr_Cofficient,
		c.Mbpr_Points,
		c.Mbpr_Min_Amount,
		c.Mbpr_Max_Amount,
		c.Mbpr_Menchant_No,
		c.Mbpr_Area_Id,
		c.Mbpr_Product_Id,
		c.Mbpr_Product_Category,
		c.Mbpr_Points_Start_Date,
		c.Mbpr_Points_End_Date,
		c.Mbpr_Start_Date,
		c.Mbpr_End_Date,
		c.Mbpr_Direction,
		c.Mbpr_Status,
		a.mbp_mbp_id,
		a.mbp_mbr_id
		from M_MEMBER_LEVEL a1,
		M_MEMBER_BENEFITS_PKG_REL a2,
		M_MEMBER_BENEFITS_PKG a,
		M_BENEFITS_POINTS_RULE c,
		M_MEMBER c1
		where a1.ml_id = a2.mbpr_ml_id
		and a2.mbpr_mbp_id = a.mbp_mbp_id
		and a.mbp_mbr_id = c.mbr_id
		and a.mbp_issuer_id = a1.ml_issuer_id
		and a1.ml_issuer_id = c1.ms_issuer_id
		and a.mbp_type = c.mbpr_type
		and a.mbp_issuer_id = #{issuerId,jdbcType=VARCHAR}
   <![CDATA[
   and c.mbpr_start_date < sysdate()
   ]]>
   <![CDATA[
   and c.mbpr_end_date > sysdate()
   ]]>
		and c.mbpr_status = 'Y'
		and c1.midentity between a1.ml_limit_point_min and a1.ml_limit_point_max
		and c1.cust_seq = #{custSeq,jdbcType=VARCHAR}
	</select>

	<select id="queryBenefitsDiscountAndLevelbyIssuerIdAndcustSeq"
		resultMap="UserBenefitsResultMap" parameterType="java.util.Map">
		select a1.ml_level_description,
		a1.ML_LEVEL,
		a1.ML_ID,
		a1.Ml_Limit_Point_Max,
		a1.ml_limit_point_min,
		b.Mbdr_Type,
		b.Mbdr_Description,
		b.Mbdr_Promotion_Type,
		b.Mbdr_Status,
		b.MBDR_RULE_CODE,
		b.MBDR_IS_FIXED,
		b.MBDR_RATE,
		b.MBDR_COFFICIENT,
		b.MBDR_AMOUNT,
		b.MBDR_MIN_AMOUNT,
		b.MBDR_MAX_AMOUNT,
		b.MBDR_MENCHANT_NO,
		b.MBDR_PRODUCT_ID,
		b.MBDR_DISCOUNT_PRODUCT_ID,
		b.MBDR_START_DATE,
		b.MBDR_END_DATE,
		a.mbp_mbp_id,
		a.mbp_mbr_id
		from M_MEMBER_LEVEL a1,
		M_MEMBER_BENEFITS_PKG_REL a2,
		M_MEMBER_BENEFITS_PKG a,
		M_BENEFITS_DISCOUNT_RULE b,
		M_MEMBER c1
		where a1.ml_id = a2.mbpr_ml_id
		and a2.mbpr_mbp_id = a.mbp_mbp_id
		and a.mbp_mbr_id = b.mbr_id
		and a.mbp_issuer_id = a1.ml_issuer_id
		and a1.ml_issuer_id = c1.ms_issuer_id
		and a.mbp_type = b.mbdr_type
		and a.mbp_issuer_id = #{issuerId,jdbcType=VARCHAR}
   <![CDATA[
   and b.mbdr_start_date < SYSDATE()
   ]]>
   <![CDATA[
   and b.mbdr_end_date > SYSDATE()
   ]]>
		and b.mbdr_status = 'Y'
		and c1.midentity between a1.ml_limit_point_min and a1.ml_limit_point_max
		and c1.cust_seq = #{custSeq,jdbcType=VARCHAR}
	</select>
</mapper>