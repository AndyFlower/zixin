<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cul.culsite.dao.expand.MMemberDTOExpandMapper">

	<select id="selectByPhoneNoAndIssUserId" resultMap="com.cul.culsite.dao.MMemberDTOMapper.BaseResultMap">
		SELECT
		MEMBER_ID, PARENTID, UNAME,
		EMAIL, PASSWORD, REGTIME,
		PW_ANSWER,
		PW_QUESTION, NAME,
		SEX, BIRTHDAY, ADVANCE,
		PROVINCE_ID, CITY_ID,
		REGION_ID,
		PROVINCE, CITY, REGION,
		ADDRESS, ZIP, MOBILE,
		TEL, POINT, MP,
		QQ, MSN, REMARK,
		LASTLOGIN, IS_AGENT, LOGINCOUNT,
		IS_CHEKED, REGISTERIP,
		RECOMMEND_POINT_STATE,
		LAST_SEND_EMAIL, INFO_FULL, FIND_CODE,
		FACE,
		NICKNAME, MIDENTITY,
		MS_COR_ID, MS_REGISTER_CHANNEL, MS_BIND_TYPE,
		MS_ISSUER_ID, CUST_SEQ, OPEN_ID,
		STATUS, PAYPASSWORD, ID_CARD,
		CERT_TYPE, CERT_NO, FULL_NAME,
		MS_CUST_ID, MERCHANT_ID,
		WC_USER_ICON_URL,
		USE_PASSWORD, WC_UNION_ID FROM M_MEMBER WHERE UNAME =
		#{phoneNo,jdbcType=VARCHAR}
		AND
		MS_ISSUER_ID=#{issUserId,jdbcType=VARCHAR}
	</select>
	<select id="selectByCustSeq" resultMap="com.cul.culsite.dao.MMemberDTOMapper.ResultMapWithBLOBs"
		parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="com.cul.culsite.dao.MMemberDTOMapper.Base_Column_List" />
		,
		<include refid="com.cul.culsite.dao.MMemberDTOMapper.Blob_Column_List" />
		from M_MEMBER
		where CUST_SEQ = #{param1,jdbcType=VARCHAR}
		and
		ms_Issuer_Id = #{param2,jdbcType=VARCHAR}
	</select>

	<update id="updateBycancelOpenId" parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update M_MEMBER
		set
		OPEN_ID = null
		where CUST_SEQ =
		#{param1,jdbcType=VARCHAR}
		and ms_Issuer_Id =
		#{param2,jdbcType=VARCHAR}


	</update>
	<select id="selectUndefaultCard" resultMap="com.cul.culsite.dao.MMemberDTOMapper.ResultMapWithBLOBs"
		parameterType="java.util.Map">
		select
		t3.*
		from M_MEMBER t3
		left join (select t1.CUST_SEQ
		from M_MEMBER t1, M_CUST_PURSE t2
		where t2.CUST_SEQ = t1.CUST_SEQ
		and
		t2.CARD_LEVER = 'P'
		and t1.STATUS != 'W1'
		and t1.MS_REGISTER_CHANNEL =
		#{reChannel,jdbcType=VARCHAR}
		and t1.MS_ISSUER_ID =
		#{issuerId,jdbcType=VARCHAR}
		) t4 on t3.CUST_SEQ = t4.CUST_SEQ
		where
		t3.STATUS != 'W1'
		and t3.MS_REGISTER_CHANNEL =
		#{reChannel,jdbcType=VARCHAR}
		and t3.MS_ISSUER_ID =
		#{issuerId,jdbcType=VARCHAR}
		and t4.CUST_SEQ is null
	</select>
</mapper>