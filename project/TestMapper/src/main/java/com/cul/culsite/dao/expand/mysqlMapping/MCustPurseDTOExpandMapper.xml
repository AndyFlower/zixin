<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cul.culsite.dao.expand.MCustPurseDTOExpandMapper">


	<select id="queryCardListByOpenIdLbs" resultMap="com.cul.culsite.dao.MCustPurseDTOMapper.BaseResultMap">
		select t1.*,
		IFNULL(t3.d, 99999999) dist from (select cp.*,mm.ms_issuer_id from
		m_cust_purse cp,m_member mm
		where cp.cust_seq=mm.cust_seq and
		cp.status='Y' and cp.type='CARD' and
		mm.open_id=#{param1,jdbcType=VARCHAR}
		and mm.ms_issuer_id in (select
		issuer_id from
		m_cloud_issuer_subject_info)) t1
		left join (select
		v.issuer_id ,min(distance) d from (select t.issuer_id,
		t.issuer_id,st_distance_sphere(POINT(t.LONGITUDE,t.LATITUDE),POINT(#{param2,jdbcType=VARCHAR}
		,#{param3,jdbcType=VARCHAR)) distance from
		M_CLOUD_MER_INFO t where t.LONGITUDE is not null and
		t.LATITUDE is not
		null ) v
		group by issuer_id order by d asc) t3 on
		t1.ms_issuer_id=t3.issuer_id order
		by dist asc
	</select>
	
	

	<select id="selectGoldPurseByCustSeq" resultMap="com.cul.culsite.dao.MCustPurseDTOMapper.BaseResultMap"
		parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="com.cul.culsite.dao.MCustPurseDTOMapper.Base_Column_List" />
		from M_CUST_PURSE
		where CUST_SEQ = #{custSeq,jdbcType=VARCHAR}
		AND TYPE=#{type,jdbcType=VARCHAR}
		AND STATUS = 'Y'
	</select>
</mapper>
  