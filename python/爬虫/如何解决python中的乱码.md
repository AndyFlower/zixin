## 什么是字符编码

字符串的编码只有两大类：

1. 通用的Unicode编码
2. 将Unicode转化成的某种类型的编码，如UTF-8、GBK等

了解Unicode编码之前，先来看计算机编程的历史。

由于计算机只能处理数字，因此处理文本时必须先转换为数字才行。最早的计算机在设计时采用8比特（bit）作为一个字节（byte），而计算机采用二进制，所以一个字节可以表示256种不同的状态，每一个状态对应一个符号，就是256个符号，从0000000到11111111。

美国人发明了计算机，同时制定了编码，以对应英文字符和二进制数字之间的关系。这种编码被称为ASCII码。ASCII码一共规定了128个字符的编码，比如大写字母A是65、二进制为01000001。

这128个字符表示英文绰绰有余，但是中文有超过10万个汉字，一个字节只能表示256种符号，显然是不够的。所以，中国使用==GB2312==作为简体中文常见的编码方式，两个字节表示一个汉字，理论上最多可以表示==256×256=65536==个符号。

不同国家都设置了自己的编码，因此，在多语言的文本中可能会出现乱码。

为了让各国/地区能够跨语言、跨平台进行文本转换与处理，Unicode就被创造了出来。

Unicode被称为统一码、万国码或单一码。也就是说，它为每种语言中的每个字符设定了统一并且唯一的二进制编码，大概包含100多万个符号。

Unicode VS ASCII:

Unicode编码通常是两个字节，而ASCII是一个字节

既然Unicode已经包含所有符号了，为什么Unicode还会被编码呢？

因为在ASCII中，英文字母只用一个字节表示就够了，但是用Unicode编码写英文的每个符号用两个字节，因此要将其中一个字节全部用0表示。这样存储造成极大的浪费，比ASCII多了一倍的存储空间。

为了节省空间，开发了一些中间格式的字符集，被称为通用转换格式UnicodeTransformation Format（UTF），常见的有UTF-8和UTF-16。

UTF-8最大的一个特点是长度可变，它可以使用1～4个字节表示一个符号，英文字母通常被编为1个字节，汉字通常被编为3个字节。

UTF8的编码规则：

1. 对于单字节的符号，字节的第1位设为0，后面7位为这个符号的Unicode码。因此对于英语字母，UTF-8编码和ASCII码是相同的。
2. 对于n字节的符号（n>1），第1个字节的前n位都设为1，第n+1位设为0，后面字节的前两位一律设为10，剩下的没有提及的二进制位全部为这个符号的Unicode码。

## Python的字符编码

在Python 3中，字符串的编码使用str和bytes两种类型。

- （1）str字符串：使用Unicode编码。

- （2）bytes字符串：使用将Unicode转化成的某种类型的编码，如UTF-8、GBK。

### encode和decode

- encode的作用是将Unicode编码转换成其他编码的字符串
- decode的作用是将其他编码的字符串转换成Unicode编码

```python
str1 = '我'
str_utf8=str.encode('utf-8')
print(str_utf8)
print(type(str_utf8))
```

在Python 3中，Unicode不可以再被解码。如果想把UTF-8转成其他非unicode编码，那么必须先decode成Unicode，再encode为其他非Unicode编码，如GBK。

## 解决中文编码问题

中文出现乱码的情况:

### 问题1：使用Requests获得网站内容后，发现中文显示乱码。

查看所爬取网页的charset属性可以获得编码类型，或者使用r.encoding，获取到之后在爬取的时候加上字符集即可。

### 问题2：将某个字符串decode时，字符串中有非法字符，程序抛出异常。

这是因为网站编码不规范，一个页面中有多种编码。

解决办法，在解码的时候忽略非法字符

> str.decode('GBK','ignore')

decode的函数原型为decode([encoding], [errors='strict'])，第二个变量为控制错误处理的方式，默认为strict，遇到非法字符时会抛出异常。

第二个参数有如下三种类型：

- （1）ignore，忽略其中的非法字符，仅显示有效字符。
- （2）replace，使用符号代替非法字符，如’? ’或’\ufffd'。
- （3）xmlcharrefreplace，使用XML字符引用代替非法字符。

### 问题3：网页使用gzip压缩，解析网页数据的时候中文不不乱码显示。

如果网页被压缩了，那么需要先解码才行。

```python
import chardet
after_gzip = r.content
print('解压后字符串的编码为:',chardet.detect(after_gzip))
print(after_gzip.decode('UTF-8'))
```



### 问题4：写入和读取文件的时候，文件显示的字符串不是正确的中文。

在使用Python 3读取和保存文件的时候，一定要注明编码方式。