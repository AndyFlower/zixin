## 享元模式

在学习享元模式之前我们先来看一个生活中的例子，比如我们给客户A做了一个产品展示相关的网站，客户A的朋友感觉也很不错，也希望做这样的产品产生网站，但是呢有要求不能和A的完全一样，比如。有人要求以博客的形式呈现、有人要求以小程序的方式呈现、有人要求以公众号的形式呈现。

基于此种需求，我们首先想到的就是将原网站复制粘贴一份，然后根据客户不同要求，进行定制修改。同时呢也为每一个系统购买一个服务器。

但是呢这种方式存在很多的问题，下面我们来详细看一下

- 需要的网站结构类似相似度很高，而且都不是高访问量网站，如果分为多个虚拟空间来处理，相当于一个相同网站的实例对象很多，造成服务器的资源浪费
- 基于第一个问题，我们可以将其整合到一个网站中，共享其相关的代码和数据，对于硬盘、内存、CPU、数据库空间等服务器资源都可以达成共享，减少服务器资源
- 对于代码来说，由于是一份实例，维护和扩展都更加容易

这种解决方案就是我们将要学习的享元模式。

### 一、享元模式基本介绍

1. 运营共享技术有效的支持大量细粒度的对象
2. 常用语系统底层开发，解决系统的性能问题，像数据库连接池，里面都是创建好的连接对象，在这些连接对象中有我们需要的则直接拿来用，避免重复创造，如果没有我们需要的，则创建一个
3. 享元模式能够解决重复对应的内存浪费的问题，当系统中有大量相思对象，需要缓冲池时，不需要总是创建新对象，可以从缓冲池里拿，这样可以降低系统内存，同时提高效率
4. 享元模式的经典使用场景就是池技术，String常量池、数据库连接池、缓存池等等都是享元模式的应用
5. 类图

![image-20200821125628402](\images\image-20200821125628402.png)

- FlyWeight是抽象的享元角色，他是产品的抽象类，同时定义出对象的外部状态和内部状态的接口或实现
- ConcreteFlyWeight是具体的享元角色，是具体的产品类，实现抽象觉得定义相关业务
- UnSharedConcreteFlyWeight是不可共享的角色，一般不会出现在享元工厂
- FlyWeightFactory享元工厂类，用于构建一个池容器，同时提高从池中获取对象方法

### 二、内部状态和外部状态

比如围棋、五子棋、调期。他们都有大量的棋子对象，围棋和五子棋只有黑白两个颜色，跳棋的颜色多一些，所以妻子的颜色就是棋子的内部状态，而各个棋子之间的差别就是位置的不太，当我们落子后，落子颜色是定的，但位置是变化的，所以棋子坐标就是棋子的外部状态。

