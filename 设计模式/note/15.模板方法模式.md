## 模板方法模式

在学习模板方法模式之前，我们先以一个生活中比较常见的例子来引入。

比如我们制作豆浆的时候，流程都是选材料---添加配料----浸泡----放到豆浆机中打碎。

我们通过添加不同的配料，就可以了制作出不同口味的豆浆。

其中 1 2 4部对于每个豆浆的制作过程都是一样的。这种情况下我们就很容易的想到模板方法。也可能你不知道这就是模板方法模式，但是你实际上已经在使用了。

### 一、模板方法模式基本介绍

1. 模板方法模式又叫模板模式，在一个抽象类公开定义了执行他的方法的模板。他的子类可有按需要重写方法实现，但调用将以抽象类中定义的方式进行
2. 简单来说，模板方法模式定义一个操作中的算法的骨架。而将一些步骤延迟到子类中，使得子类可以不改变一个算法的结构，就可以了重新定义该算法的某些特定步骤
3. 这种设计模式属于**行为型模式**

```java
void refresh() throws BeansException, IllegalStateException;
```

```java
public void refresh() throws BeansException, IllegalStateException {
    synchronized(this.startupShutdownMonitor) {
        this.prepareRefresh();
        ConfigurableListableBeanFactory beanFactory = this.obtainFreshBeanFactory();
        this.prepareBeanFactory(beanFactory);

        try {
            this.postProcessBeanFactory(beanFactory);
            this.invokeBeanFactoryPostProcessors(beanFactory);
            this.registerBeanPostProcessors(beanFactory);
            this.initMessageSource();
            this.initApplicationEventMulticaster();
            this.onRefresh();
            this.registerListeners();
            this.finishBeanFactoryInitialization(beanFactory);
            this.finishRefresh();
        } catch (BeansException var9) {
            if (this.logger.isWarnEnabled()) {
                this.logger.warn("Exception encountered during context initialization - cancelling refresh attempt: " + var9);
            }

            this.destroyBeans();
            this.cancelRefresh(var9);
            throw var9;
        } finally {
            this.resetCommonCaches();
        }

    }
}
```

```java
protected ConfigurableListableBeanFactory obtainFreshBeanFactory() {
    this.refreshBeanFactory();//抽象方法
    return this.getBeanFactory();//抽象方法
}
```

```java
//钩子方法
protected void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
}
```

```java
//钩子方法
protected void onRefresh() throws BeansException {
}
```

![image-20200826090143271](\images\image-20200826090143271.png)